load "config.m";
SetVerbose("Shimura", true);
SetLogFile("d9g0-060522.log");

filenames := [ "9T23-[4,3,3]-441-33111-333-g0.m", "9T33-[10,15,4]-522-531-42111-g0.m", "9T33-[10,15,6]-522-531-32211-g0.m", "9T33-[12,12,6]-432-432-32211-g0.m", "9T33-[12,4,6]-432-441-32211-g0.m", "9T33-[15,15,4]-531-531-42111-g0.m", "9T33-[15,15,6]-531-531-32211-g0.m", "9T33-[15,3,12]-531-33111-432-g0.m", "9T33-[15,4,12]-531-42111-432-g0.m", "9T33-[15,4,4]-531-42111-441-g0.m", "9T33-[15,4,6]-531-441-32211-g0.m", "9T33-[15,6,12]-531-32211-432-g0.m", "9T33-[4,12,12]-42111-432-432-g0.m", "9T33-[4,12,4]-42111-432-441-g0.m", "9T33-[4,4,3]-441-441-33111-g0.m", "9T33-[6,10,6]-621-522-32211-g0.m", "9T33-[6,12,2]-621-432-22221-g0.m", "9T33-[6,12,3]-621-432-33111-g0.m", "9T33-[6,12,6]-621-432-32211-g0.m", "9T33-[6,15,4]-621-531-42111-g0.m", "9T33-[6,15,6]-621-531-32211-g0.m", "9T33-[6,4,10]-621-42111-522-g0.m", "9T33-[6,4,12]-621-42111-432-g0.m", "9T33-[6,4,4]-621-42111-441-g0.m", "9T33-[6,6,4]-621-32211-441-g0.m", "9T33-[6,6,4]-621-621-42111-g0.m", "9T33-[6,6,6]-621-621-32211-g0.m", "9T33-[7,10,6]-711-522-32211-g0.m", "9T33-[7,12,6]-711-432-32211-g0.m", "9T33-[7,15,4]-711-531-42111-g0.m", "9T33-[7,15,6]-711-531-32211-g0.m", "9T33-[7,3,4]-711-333-42111-g0.m", "9T33-[7,4,12]-711-42111-432-g0.m", "9T33-[7,4,6]-711-441-32211-g0.m", "9T33-[7,6,4]-711-621-42111-g0.m", "9T33-[7,6,6]-711-32211-621-g0.m", "9T33-[7,7,6]-711-711-32211-g0.m", "9T33-[9,6,4]-9-32211-42111-g0.m", "9T33-[9,6,6]-9-32211-32211-g0.m", "9T34-[10,10,10]-5211-5211-522-g0.m", "9T34-[10,10,12]-5211-5211-432-g0.m", "9T34-[10,10,15]-5211-5211-531-g0.m", "9T34-[10,10,4]-5211-5211-441-g0.m", "9T34-[10,10,4]-5211-522-4221-g0.m", "9T34-[10,10,6]-522-5211-3321-g0.m", "9T34-[10,12,10]-5211-4311-522-g0.m", "9T34-[10,12,12]-5211-4311-432-g0.m", "9T34-[10,12,12]-522-4311-4311-g0.m", "9T34-[10,12,15]-5211-4311-531-g0.m", "9T34-[10,12,4]-5211-432-4221-g0.m", "9T34-[10,12,4]-522-4311-4221-g0.m", "9T34-[10,12,6]-5211-432-3321-g0.m", "9T34-[10,12,6]-522-4311-3321-g0.m", "9T34-[10,15,6]-5211-531-3222-g0.m", "9T34-[10,15,6]-5211-531-3321-g0.m", "9T34-[10,20,4]-5211-54-42111-g0.m", "9T34-[10,20,6]-5211-54-32211-g0.m", "9T34-[10,4,12]-5211-441-4311-g0.m", "9T34-[10,4,4]-5211-441-4221-g0.m", "9T34-[10,4,6]-5211-441-3321-g0.m", "9T34-[12,12,12]-4311-4311-432-g0.m", "9T34-[12,12,4]-4311-4311-441-g0.m", "9T34-[12,12,6]-4311-432-3321-g0.m", "9T34-[12,4,6]-4311-441-3222-g0.m", "9T34-[12,4,6]-4311-441-3321-g0.m", "9T34-[12,6,6]-432-3321-3321-g0.m", "9T34-[14,12,4]-72-4311-42111-g0.m", "9T34-[14,12,6]-72-432-321111-g0.m", "9T34-[14,15,4]-72-531-411111-g0.m", "9T34-[14,15,6]-72-531-321111-g0.m", "9T34-[14,3,12]-72-33111-4311-g0.m", "9T34-[14,4,10]-72-42111-5211-g0.m", "9T34-[14,4,4]-72-42111-4221-g0.m", "9T34-[14,4,5]-72-4221-51111-g0.m", "9T34-[14,4,6]-72-42111-6111-g0.m", "9T34-[14,5,12]-72-51111-4311-g0.m", "9T34-[14,6,10]-72-32211-5211-g0.m", "9T34-[14,6,12]-72-32211-4311-g0.m", "9T34-[14,6,2]-72-63-2211111-g0.m", "9T34-[14,6,4]-72-32211-4221-g0.m", "9T34-[14,6,4]-72-3321-42111-g0.m", "9T34-[14,6,6]-72-321111-621-g0.m", "9T34-[14,6,6]-72-32211-3321-g0.m", "9T34-[15,10,4]-531-5211-4221-g0.m", "9T34-[15,12,12]-531-4311-4311-g0.m", "9T34-[15,12,4]-531-4311-4221-g0.m", "9T34-[15,20,6]-531-54-321111-g0.m", "9T34-[15,4,4]-531-4221-4221-g0.m", "9T34-[15,6,12]-531-3222-4311-g0.m", "9T34-[15,6,12]-531-3321-4311-g0.m", "9T34-[15,6,4]-531-3321-4221-g0.m", "9T34-[15,6,6]-531-3321-3321-g0.m", "9T34-[20,12,4]-54-4311-42111-g0.m", "9T34-[20,12,6]-54-432-321111-g0.m", "9T34-[20,4,4]-54-42111-4221-g0.m", "9T34-[20,6,12]-54-32211-4311-g0.m", "9T34-[20,6,4]-54-32211-4221-g0.m", "9T34-[20,6,4]-54-3321-42111-g0.m", "9T34-[20,6,6]-54-32211-3321-g0.m", "9T34-[4,12,12]-4221-4311-432-g0.m", "9T34-[4,12,4]-4221-4311-441-g0.m", "9T34-[4,12,6]-4221-432-3321-g0.m", "9T34-[4,4,12]-4221-4221-432-g0.m", "9T34-[4,6,4]-4221-3321-441-g0.m", "9T34-[6,10,10]-621-5211-5211-g0.m", "9T34-[6,10,12]-6111-5211-432-g0.m", "9T34-[6,10,12]-621-5211-4311-g0.m", "9T34-[6,10,15]-6111-5211-531-g0.m", "9T34-[6,10,4]-6111-5211-441-g0.m", "9T34-[6,10,6]-6111-5211-621-g0.m", "9T34-[6,10,6]-621-5211-3222-g0.m", "9T34-[6,10,6]-621-5211-3321-g0.m", "9T34-[6,10,6]-63-5211-32211-g0.m", "9T34-[6,12,12]-6111-4311-432-g0.m", "9T34-[6,12,12]-621-4311-4311-g0.m", "9T34-[6,12,15]-6111-4311-531-g0.m", "9T34-[6,12,4]-63-432-411111-g0.m", "9T34-[6,12,6]-6111-4311-621-g0.m", "9T34-[6,12,6]-6111-432-3321-g0.m", "9T34-[6,12,6]-621-4311-3321-g0.m", "9T34-[6,12,6]-63-4311-32211-g0.m", "9T34-[6,15,4]-63-531-411111-g0.m", "9T34-[6,15,6]-6111-531-3321-g0.m", "9T34-[6,20,6]-621-54-321111-g0.m", "9T34-[6,3,4]-6111-333-4221-g0.m", "9T34-[6,4,10]-621-4221-5211-g0.m", "9T34-[6,4,10]-63-42111-5211-g0.m", "9T34-[6,4,12]-6111-4221-432-g0.m", "9T34-[6,4,12]-621-4221-4311-g0.m", "9T34-[6,4,12]-63-42111-4311-g0.m", "9T34-[6,4,15]-6111-4221-531-g0.m", "9T34-[6,4,4]-621-4221-4221-g0.m", "9T34-[6,4,4]-63-42111-4221-g0.m", "9T34-[6,4,6]-63-4221-32211-g0.m", "9T34-[6,4,6]-63-441-321111-g0.m", "9T34-[6,5,6]-63-51111-3321-g0.m", "9T34-[6,6,2]-63-3321-22221-g0.m", "9T34-[6,6,4]-621-3321-4221-g0.m", "9T34-[6,6,4]-621-6111-4221-g0.m", "9T34-[6,6,4]-63-3321-42111-g0.m", "9T34-[6,6,6]-6111-3321-621-g0.m", "9T34-[6,6,6]-621-3321-3321-g0.m", "9T34-[6,6,6]-63-3321-32211-g0.m", "9T34-[6,6,6]-63-621-321111-g0.m", "9T34-[7,10,10]-711-5211-5211-g0.m", "9T34-[7,10,12]-711-5211-4311-g0.m", "9T34-[7,10,6]-711-5211-3321-g0.m", "9T34-[7,12,12]-711-4311-4311-g0.m", "9T34-[7,12,6]-711-4311-3321-g0.m", "9T34-[7,20,6]-711-54-321111-g0.m", "9T34-[7,4,10]-711-4221-5211-g0.m", "9T34-[7,4,12]-711-4221-4311-g0.m", "9T34-[7,4,4]-711-4221-4221-g0.m", "9T34-[7,6,4]-711-3321-4221-g0.m", "9T34-[7,6,6]-711-321111-63-g0.m", "9T34-[7,6,6]-711-3321-3321-g0.m", "9T34-[8,10,3]-81-5211-33111-g0.m", "9T34-[8,10,4]-81-5211-42111-g0.m", "9T34-[8,10,6]-81-5211-32211-g0.m", "9T34-[8,12,4]-81-4311-42111-g0.m", "9T34-[8,12,6]-81-4311-32211-g0.m", "9T34-[8,12,6]-81-432-321111-g0.m", "9T34-[8,15,6]-81-531-321111-g0.m", "9T34-[8,3,6]-81-3111111-63-g0.m", "9T34-[8,4,4]-81-42111-4221-g0.m", "9T34-[8,4,6]-81-411111-621-g0.m", "9T34-[8,6,4]-81-32211-4221-g0.m", "9T34-[8,6,4]-81-3321-42111-g0.m", "9T34-[8,6,6]-81-321111-621-g0.m", "9T34-[8,6,6]-81-32211-3321-g0.m" ];

while true do
  asg := Random([1..#filenames]);
  sIn := BelyiDBRead(filenames[asg]);
  if sIn`BelyiDBPointedSize gt 16 or BelyiMapIsComputed(sIn) then
    continue; 
  end if;
  Gammas := BelyiDBToGammas(sIn);
  prec := 30;
  d := Degree(Universe(DefiningPermutation(Gammas[1])));
  m0 := #PassportRepresentatives(DefiningPermutation(Gammas[1]) : Pointed := true);
  precNewton := 200*m0*Round(Log(d));
  halfbaseprecNewton := precNewton div 2;
  for i := 1 to #Gammas do
    Gamma := Gammas[i];
    while not assigned Gamma`TriangleBelyiCurve do
      try 
        X, phi := BelyiMap(Gamma : prec := prec, precNewton := precNewton);
      catch e
        print "ERROR ERROR ERROR ERROR, increasing precision: ", e`Object;
        prec +:= 15;
        precNewton +:= halfbaseprecNewton;
        Gamma := TriangleSubgroup(sIn`BelyiDBPointedPassport[i]);
        Gammas[i] := Gamma;
      end try;
    end while;
  end for;

  print "Final precision:", prec;
  sOut := GammasToBelyiDB(Gammas); BelyiDBWrite(sOut);
end while;
